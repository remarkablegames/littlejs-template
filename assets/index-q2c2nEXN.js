(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const Ne=0;const x=Math.PI;function F(s){return Math.abs(s)}function W(s,t){return Math.min(s,t)}function Et(s,t){return Math.max(s,t)}function it(s){return Math.sign(s)}function Lt(s,t=1){return(s%t+t)%t}function p(s,t=0,e=1){return s<t?t:s>e?e:s}function _(s,t,e){return(e-=t)?p((s-t)/e):0}function ht(s,t,e){return t+p(s)*(e-t)}function Zt(s,t,e,n=c()){return 2*F(s.x-e.x)<t.x+n.x&&2*F(s.y-e.y)<t.y+n.y}function be(s=1,t=1,e=dt){return t/2*(1-Math.cos(e*s*2*x))}function w(s=1,t=0){return t+Math.random()*(s-t)}function At(s,t=0){return Math.floor(w(s,t))}function Le(){return 2*At(2)-1}function ce(s=1){return new A().setAngle(w(2*x),s)}function Oe(s=1,t=0){return 0<s?ce(s*w(t/s,1)**.5):new A}function It(s=new g,t=new g(0,0,0,1),e=!1){return e?s.lerp(t,w()):new g(w(s.r,t.r),w(s.g,t.g),w(s.b,t.b),w(s.a,t.a))}function c(s=0,t){return typeof s=="number"?new A(s,t??s):new A(s.x,s.y)}class A{constructor(t=0,e=0){this.x=t,this.y=e,this.isValid()}set(t=0,e=0){return this.x=t,this.y=e,this.isValid(),this}copy(){return new A(this.x,this.y)}add(t){return new A(this.x+t.x,this.y+t.y)}subtract(t){return new A(this.x-t.x,this.y-t.y)}multiply(t){return new A(this.x*t.x,this.y*t.y)}divide(t){return new A(this.x/t.x,this.y/t.y)}scale(t){return new A(this.x*t,this.y*t)}length(){return this.lengthSquared()**.5}lengthSquared(){return this.x**2+this.y**2}distance(t){return this.distanceSquared(t)**.5}distanceSquared(t){return(this.x-t.x)**2+(this.y-t.y)**2}normalize(t=1){const e=this.length();return e?this.scale(t/e):new A(0,t)}clampLength(t=1){const e=this.length();return e>t?this.scale(t/e):this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}angle(){return Math.atan2(this.x,this.y)}setAngle(t=0,e=1){return this.x=e*Math.sin(t),this.y=e*Math.cos(t),this}rotate(t){const e=Math.cos(-t);return t=Math.sin(-t),new A(this.x*e-this.y*t,this.x*t+this.y*e)}setDirection(t,e=1){return t=Lt(t,4),c(t%2?t-1?-e:e:0,t%2?0:t?-e:e)}direction(){return F(this.x)>F(this.y)?0>this.x?3:1:0>this.y?2:0}invert(){return new A(this.y,-this.x)}floor(){return new A(Math.floor(this.x),Math.floor(this.y))}area(){return F(this.x*this.y)}lerp(t,e){return this.add(t.subtract(this).scale(p(e)))}arrayCheck(t){return 0<=this.x&&0<=this.y&&this.x<t.x&&this.y<t.y}toString(t=3){}isValid(){return typeof this.x=="number"&&!isNaN(this.x)&&typeof this.y=="number"&&!isNaN(this.y)}}function b(s,t,e,n){return new g(s,t,e,n)}function G(s,t,e,n){return new g().setHSLA(s,t,e,n)}class g{constructor(t=1,e=1,n=1,i=1){this.r=t,this.g=e,this.b=n,this.a=i,this.isValid()}set(t=1,e=1,n=1,i=1){return this.r=t,this.g=e,this.b=n,this.a=i,this.isValid(),this}copy(){return new g(this.r,this.g,this.b,this.a)}add(t){return new g(this.r+t.r,this.g+t.g,this.b+t.b,this.a+t.a)}subtract(t){return new g(this.r-t.r,this.g-t.g,this.b-t.b,this.a-t.a)}multiply(t){return new g(this.r*t.r,this.g*t.g,this.b*t.b,this.a*t.a)}divide(t){return new g(this.r/t.r,this.g/t.g,this.b/t.b,this.a/t.a)}scale(t,e=t){return new g(this.r*t,this.g*t,this.b*t,this.a*e)}clamp(){return new g(p(this.r),p(this.g),p(this.b),p(this.a))}lerp(t,e){return this.add(t.subtract(this).scale(p(e)))}setHSLA(t=0,e=0,n=1,i=1){t=Lt(t,1),e=p(e),n=p(n),e=.5>n?n*(1+e):n+e-n*e,n=2*n-e;const o=(r,h,a)=>1>6*(a=Lt(a,1))?r+6*(h-r)*a:1>2*a?h:2>3*a?r+(h-r)*(4-6*a):r;return this.r=o(n,e,t+1/3),this.g=o(n,e,t),this.b=o(n,e,t-1/3),this.a=i,this.isValid(),this}HSLA(){const t=p(this.r),e=p(this.g),n=p(this.b),i=p(this.a),o=Math.max(t,e,n),r=Math.min(t,e,n),h=(o+r)/2;let a=0,d=0;if(o!=r){let m=o-r;d=.5<h?m/(2-o-r):m/(o+r),t==o?a=(e-n)/m+(e<n?6:0):e==o?a=(n-t)/m+2:n==o&&(a=(t-e)/m+4)}return[a/6,d,h,i]}mutate(t=.05,e=0){return new g(this.r+w(t,-t),this.g+w(t,-t),this.b+w(t,-t),this.a+w(e,-e)).clamp()}toString(t=!0){const e=n=>(16>(n=255*p(n)|0)?"0":"")+n.toString(16);return"#"+e(this.r)+e(this.g)+e(this.b)+(t?e(this.a):"")}setHex(t){return typeof t=="string"&&t[0]=="#",[4,5,7,9].includes(t.length),6>t.length?(this.r=p(parseInt(t[1],16)/15),this.g=p(parseInt(t[2],16)/15),this.b=p(parseInt(t[3],16)/15),this.a=t.length==5?p(parseInt(t[4],16)/15):1):(this.r=p(parseInt(t.slice(1,3),16)/255),this.g=p(parseInt(t.slice(3,5),16)/255),this.b=p(parseInt(t.slice(5,7),16)/255),this.a=t.length==9?p(parseInt(t.slice(7,9),16)/255):1),this.isValid(),this}rgbaInt(){const t=255*p(this.r)|0,e=255*p(this.g)<<8,n=255*p(this.b)<<16,i=255*p(this.a)<<24;return t+e+n+i}isValid(){return typeof this.r=="number"&&!isNaN(this.r)&&typeof this.g=="number"&&!isNaN(this.g)&&typeof this.b=="number"&&!isNaN(this.b)&&typeof this.a=="number"&&!isNaN(this.a)}}b();b(0,0,0);b(.5,.5,.5);b(1,0,0);b(1,.5,0);b(1,1,0);b(0,1,0);b(0,1,1);b(0,0,1);b(.5,0,1);b(1,0,1);let U=c(),R=32,te=c(1920,1080),bt=c(),Be="arial",ue=!1,de=!0,me=c(16),at=0,Me=1,ke=1,Fe=1,Ue=0,je=.8,K=1,Ot=0,ee=1,_e=!0,Ge=!1,We=.3,Ye=40,He=.7,ie=5,gt=.5,se=c(640,80);function Xe(s){U=s}function qe(s){R=s}function Ke(s){ue=s}function Ve(s){Ot=s}class Wt{constructor(t=c(),e=c(1),n,i=0,o=new g,r=0){this.pos=t.copy(),this.size=e,this.drawSize=void 0,this.tileInfo=n,this.angle=i,this.color=o,this.additiveColor=void 0,this.mirror=!1,this.mass=Me,this.damping=ke,this.angleDamping=Fe,this.elasticity=Ue,this.friction=je,this.gravityScale=1,this.renderOrder=r,this.velocity=c(),this.angleVelocity=0,this.spawnTime=dt,this.children=[],this.clampSpeedLinear=!0,this.parent=this.groundObject=void 0,this.localPos=c(),this.localAngle=0,this.collideRaycast=this.isSolid=this.collideSolidObjects=this.collideTiles=!1,V.push(this)}updateTransforms(){const t=this.parent;if(t){const e=t.getMirrorSign();this.pos=this.localPos.multiply(c(e,1)).rotate(t.angle).add(t.pos),this.angle=e*this.localAngle+t.angle}for(const e of this.children)e.updateTransforms()}update(){if(!this.parent){if(this.clampSpeedLinear)this.velocity.x=p(this.velocity.x,-K,K),this.velocity.y=p(this.velocity.y,-K,K);else{var t=this.velocity.lengthSquared();t>K*K&&(t=K/t**.5,this.velocity.x*=t,this.velocity.y*=t)}if(t=this.pos.copy(),this.velocity.x*=this.damping,this.velocity.y*=this.damping,this.mass&&(this.velocity.y+=Ot*this.gravityScale),this.pos.x+=this.velocity.x,this.pos.y+=this.velocity.y,this.angle+=this.angleVelocity*=this.angleDamping,0<=this.angleDamping&&1>=this.angleDamping,0<=this.damping&&1>=this.damping,this.mass){var e=0>this.velocity.y;if(this.groundObject){var n=this.groundObject!=this&&this.groundObject.velocity?this.groundObject.velocity.x:0;this.velocity.x=n+(this.velocity.x-n)*this.friction,this.groundObject=void 0}if(this.collideSolidObjects)for(var i of De){if(!this.isSolid&&!i.isSolid||i.destroyed||i.parent||i==this||!Zt(this.pos,this.size,i.pos,i.size))continue;n=this.collideWithObject(i);var o=i.collideWithObject(this);if(!n||!o)continue;if(Zt(t,this.size,i.pos,i.size)){n=t.subtract(i.pos),o=n.length(),n=.01>o?ce(.001):n.scale(.001/o),this.velocity=this.velocity.add(n),i.mass&&(i.velocity=i.velocity.subtract(n));continue}o=this.size.add(i.size);var r=2*(t.y-i.pos.y)>o.y+Ot;const a=2*F(t.y-i.pos.y)<o.y;var h=2*F(t.x-i.pos.x)<o.x;if(n=Et(this.elasticity,i.elasticity),r||h||!a){if(this.pos.y=i.pos.y+(o.y/2+.001)*it(t.y-i.pos.y),i.groundObject&&e||!i.mass)e&&(this.groundObject=i),this.velocity.y*=-n;else if(i.mass){h=(this.mass*this.velocity.y+i.mass*i.velocity.y)/(this.mass+i.mass);const d=i.velocity.y*(i.mass-this.mass)/(this.mass+i.mass)+2*this.velocity.y*this.mass/(this.mass+i.mass);this.velocity.y=ht(n,h,this.velocity.y*(this.mass-i.mass)/(this.mass+i.mass)+2*i.velocity.y*i.mass/(this.mass+i.mass)),i.velocity.y=ht(n,h,d)}}!r&&a&&(this.pos.x=i.pos.x+(o.x/2+.001)*it(t.x-i.pos.x),i.mass?(o=(this.mass*this.velocity.x+i.mass*i.velocity.x)/(this.mass+i.mass),r=i.velocity.x*(i.mass-this.mass)/(this.mass+i.mass)+2*this.velocity.x*this.mass/(this.mass+i.mass),this.velocity.x=ht(n,o,this.velocity.x*(this.mass-i.mass)/(this.mass+i.mass)+2*i.velocity.x*i.mass/(this.mass+i.mass)),i.velocity.x=ht(n,o,r)):this.velocity.x*=-n)}this.collideTiles&&pt(this.pos,this.size,this)&&!pt(t,this.size,this)&&(i=pt(c(t.x,this.pos.y),this.size,this),n=pt(c(this.pos.x,t.y),this.size,this),(i||!n)&&(this.velocity.y*=-this.elasticity,e?(this.pos.y=(t.y-this.size.y/2|0)+this.size.y/2+1e-4,this.groundObject=this):(this.pos.y=t.y,this.groundObject=void 0)),n&&(this.pos.x=t.x,this.velocity.x*=-this.elasticity))}}}render(){st(this.pos,this.drawSize||this.size,this.tileInfo,this.color,this.angle,this.mirror,this.additiveColor)}destroy(){if(!this.destroyed){this.destroyed=1,this.parent&&this.parent.removeChild(this);for(const t of this.children)t.destroy(t.parent=0)}}localToWorld(t){return this.pos.add(t.rotate(this.angle))}worldToLocal(t){return t.subtract(this.pos).rotate(-this.angle)}localToWorldVector(t){return t.rotate(this.angle)}worldToLocalVector(t){return t.rotate(-this.angle)}collideWithTile(t,e){return 0<t}collideWithObject(t){return!0}getAliveTime(){return dt-this.spawnTime}applyAcceleration(t){this.mass&&(this.velocity=this.velocity.add(t))}applyForce(t){this.applyAcceleration(t.scale(1/this.mass))}getMirrorSign(){return this.mirror?-1:1}addChild(t,e=c(),n=0){!t.parent&&this.children.includes(t),this.children.push(t),t.parent=this,t.localPos=e.copy(),t.localAngle=n}removeChild(t){t.parent==this&&this.children.includes(t),this.children.splice(this.children.indexOf(t),1),t.parent=0}setCollision(t=!0,e=!0,n=!0,i=!0){this.collideSolidObjects=t,this.isSolid=e,this.collideTiles=n,this.collideRaycast=i}toString(){}renderDebugInfo(){}}let y,D,M,$,z=c(),Q=[];function Dt(s=c(),t=me,e=0,n=0){typeof t=="number"&&(t=c(t));var i=Q[e];const o=t.add(c(2*n));return typeof s=="number"&&(i=i.size.x/o.x|0,s=0<i?c(s%i,s/i|0):c()),s=c(s.x*o.x+n,s.y*o.y+n),new Yt(s,t,e,n)}class Yt{constructor(t=c(),e=me,n=0,i=0){this.pos=t.copy(),this.size=e.copy(),this.textureIndex=n,this.padding=i}offset(t){return new Yt(this.pos.add(t),this.size,this.textureIndex)}frame(t){return this.offset(c(t*(this.size.x+2*this.padding),0))}getTextureInfo(){return Q[this.textureIndex]}}class ne{constructor(t){this.image=t,this.size=c(t.width,t.height),this.glTexture=Ei(t)}}function fe(s){return new A((s.x-z.x/2+.5)/R+U.x,(s.y-z.y/2+.5)/-R+U.y)}function Ht(s){return new A((s.x-U.x)*R+z.x/2-.5,(s.y-U.y)*-R+z.y/2-.5)}function st(s,t=c(1),e,n=new g,i=0,o,r=new g(0,0,0,0),h=de,a,d){const m=e&&e.getTextureInfo();if(h)if(a&&(s=fe(s),t=t.scale(1/R)),m){var u=c(1).divide(m.size);h=e.pos.x*u.x,a=e.pos.y*u.y,d=e.size.x*u.x;const f=e.size.y*u.y;u=u.scale(at),wi(m.glTexture),le(s.x,s.y,o?-t.x:t.x,t.y,i,h+u.x,a+u.y,h-u.x+d,a-u.y+f,n.rgbaInt(),r.rgbaInt())}else le(s.x,s.y,t.x,t.y,i,0,0,0,0,0,n.rgbaInt());else t=c(t.x,-t.y),$e(s,t,i,o,f=>{if(m){const v=e.pos.x+at,L=e.pos.y+at,Y=e.size.x-2*at,C=e.size.y-2*at;f.globalAlpha=n.a,f.drawImage(m.image,v,L,Y,C,-.5,-.5,1,1),f.globalAlpha=1}else f.fillStyle=n.toString(),f.fillRect(-.5,-.5,1,1)},a,d)}function Je(s,t,e,n,i,o,r){st(s,t,void 0,e,n,!1,void 0,i,o,r)}function $e(s,t,e,n,i,o,r=D){o||(s=Ht(s),t=t.scale(R)),r.save(),r.translate(s.x+.5,s.y+.5),r.rotate(e),r.scale(n?-t.x:t.x,-t.y),i(r),r.restore()}function vt(s,t,e=1,n=new g,i=0,o=new g(0,0,0),r="center",h=Be,a,d=$){d.fillStyle=n.toString(),d.lineWidth=i,d.strokeStyle=o.toString(),d.textAlign=r,d.font=e+"px "+h,d.textBaseline="middle",d.lineJoin="round",t=t.copy(),s=(s+"").split(`
`),t.y-=(s.length-1)*e/2,s.forEach(m=>{i&&d.strokeText(m,t.x,t.y,a),d.fillText(m,t.x,t.y,a),t.y+=e})}function re(s,t=de,e){t?zt=s:(e||=D,e.globalCompositeOperation=s?"lighter":"source-over")}function Qe(s,t=0){return T[t]&&!!(T[t][s]&1)}function Ze(s,t=0){return T[t]&&!!(T[t][s]&2)}function Xt(){T=[[]]}const ti=Ze;let Bt=c(),ut=c(),Ct=!1;function lt(s,t=0){return Qe(s,t+1)}let T=[[]];function ei(){ye||document.hasFocus()||Xt(),Bt=fe(ut),ni()}function ii(){for(const s of T)for(const t in s)s[t]&=1}function si(){function s(t){return t=="KeyW"?"ArrowUp":t=="KeyS"?"ArrowDown":t=="KeyA"?"ArrowLeft":t=="KeyD"?"ArrowRight":t}onkeydown=t=>{t.repeat||(Ct=!1,T[0][t.code]=3,T[0][s(t.code)]=3)},onkeyup=t=>{T[0][t.code]=4,T[0][s(t.code)]=4},onmousedown=t=>{I&&I.state!="running"&&I.resume(),Ct=!1,T[0][t.button]=3,ut=Mt(t),t.button&&t.preventDefault()},onmouseup=t=>T[0][t.button]=T[0][t.button]&2|4,onmousemove=t=>ut=Mt(t),onwheel=t=>t.ctrlKey?0:it(t.deltaY),oncontextmenu=t=>!1,onblur=t=>Xt(),ye&&_e&&ri()}function Mt(s){const t=y.getBoundingClientRect(),e=_(s.x,t.left,t.right);return s=_(s.y,t.top,t.bottom),c(e*y.width,s*y.height)}const oe=[];function ni(){const s=r=>{const h=a=>.3<a?_(a,.3,.8):-.3>a?-_(-a,.3,.8):0;return c(h(r.x),h(-r.y)).clampLength()};var t,e,n,i;if(navigator&&navigator.getGamepads&&document.hasFocus())for(t=navigator.getGamepads(),e=t.length;e--;){i=t[e];const r=T[e+1]||(T[e+1]=[]);if(n=oe[e]||(oe[e]=[]),i){for(var o=0;o<i.axes.length-1;o+=2)n[o>>1]=s(c(i.axes[o],i.axes[o+1]));for(o=i.buttons.length;o--;){const h=i.buttons[o],a=lt(o,e);r[o]=h.pressed?a?1:3:a?4:0,Ct||=!e&&h.pressed}i=c((lt(15,e)&&1)-(lt(14,e)&&1),(lt(12,e)&&1)-(lt(13,e)&&1)),i.lengthSquared()&&(n[0]=i.clampLength())}}}const ye=window.ontouchstart!==void 0;function ri(){function s(n){I&&I.state!="running"&&I.resume();const i=n.touches.length;if(i){const o=c(n.touches[0].clientX,n.touches[0].clientY);ut=Mt(o),e?Ct=Ge:T[0][0]=3}else e&&(T[0][0]=T[0][0]&2|4);return e=i,document.hasFocus()&&n.preventDefault(),!0}let t=s;document.addEventListener("touchstart",n=>t(n),{passive:!1}),document.addEventListener("touchmove",n=>t(n),{passive:!1}),document.addEventListener("touchend",n=>t(n),{passive:!1}),onmousedown=onmouseup=()=>0;let e}let I=new AudioContext,St;function oi(){St=I.createGain(),St.connect(I.destination),St.gain.value=We}class ai{constructor(t,e=Ye,n=He){this.range=e,this.taper=n,this.randomness=0,t&&(this.randomness=t[1]!=null?t[1]:.05,t[1]=0,this.sampleChannels=[hi(...t)],this.sampleRate=qt)}play(t,e=1,n=1,i=1,o=!1){if(this.sampleChannels){var r;if(t){if(r=this.range){const h=U.distanceSquared(t);if(h>r*r)return;e*=_(h**.5,r,r*this.taper)}r=2*Ht(t).x/y.width-1}return t=n+n*this.randomness*i*w(-1,1),this.gainNode=I.createGain(),this.source=li(this.sampleChannels,e,t,r,o,this.sampleRate,this.gainNode)}}setVolume(t=1){this.gainNode&&(this.gainNode.gain.value=t)}stop(){this.source&&this.source.stop(),this.source=void 0}getSource(){return this.source}playNote(t,e,n){return this.play(e,n,2**(t/12),0)}getDuration(){return this.sampleChannels&&this.sampleChannels[0].length/this.sampleRate}isLoading(){return!this.sampleChannels}}function li(s,t=1,e=1,n=0,i=!1,o=qt,r){{var h=I.createBuffer(s.length,s[0].length,o),a=I.createBufferSource();return s.forEach((d,m)=>h.getChannelData(m).set(d)),a.buffer=h,a.playbackRate.value=e,a.loop=i,r=r||I.createGain(),r.gain.value=t,r.connect(St),s=new StereoPannerNode(I,{pan:p(n,-1,1)}),a.connect(s).connect(r),I.state!="running"?I.resume().then(()=>a.start()):a.start(),a}}const qt=44100;function hi(s=1,t=.05,e=220,n=0,i=0,o=.1,r=0,h=1,a=0,d=0,m=0,u=0,f=0,v=0,L=0,Y=0,C=0,nt=1,X=0,mt=0,Z=0){let P=2*x;var S=qt;let Pt=a*=500*P/S/S;t=e*=w(1+t,1-t)*P/S;let tt=[],j=0,Nt=0,E=0,rt=1,ze=0,Pe=0,O=0,et;var ft=P*F(Z)*2/S,ot=Math.cos(ft),yt=Math.sin(ft)/2/2,q=1+yt;ft=-2*ot/q,yt=(1-yt)/q;let Vt=(1+it(Z)*ot)/2/q;ot=-(it(Z)+ot)/q;let Jt=q=0,$t=0,Qt=0;for(n=n*S+9,X*=S,i*=S,o*=S,C*=S,d*=500*P/S**3,L*=P/S,m*=P/S,u*=S,f=f*S|0,et=n+X+i+o+C|0;E<et;tt[E++]=O*s)++Pe%(100*Y|0)||(O=r?1<r?2<r?3<r?Math.sin(j**3):p(Math.tan(j),1,-1):1-(2*j/P%2+2)%2:1-4*F(Math.round(j/P)-j/P):Math.sin(j),O=(f?1-mt+mt*Math.sin(P*E/f):1)*it(O)*F(O)**h*(E<n?E/n:E<n+X?1-(E-n)/X*(1-nt):E<n+X+i?nt:E<et-C?(et-E-C)/o*nt:0),O=C?O/2+(C>E?0:(E<et-C?1:(et-E)/C)*tt[E-C|0]/2/s):O,Z&&(O=Qt=Vt*q+ot*(q=Jt)+Vt*(Jt=O)-yt*$t-ft*($t=Qt))),S=(e+=a+=d)*Math.cos(L*Nt++),j+=S+S*v*Math.sin(E**5),rt&&++rt>u&&(e+=m,t+=m,rt=0),!f||++ze%f||(e=t,a=Pt,rt=rt||1);return tt}let ct=[],H=c();function ci(s){for(H=s,ct=[],s=ct.length=H.area();s--;)ct[s]=0}function ui(s,t=0){s.arrayCheck(H)&&(ct[(s.y|0)*H.x+s.x|0]=t)}function pt(s,t=c(),e){const n=Et(s.x-t.x/2|0,0);var i=Et(s.y-t.y/2|0,0);const o=W(s.x+t.x/2,H.x);for(s=W(s.y+t.y/2,H.y);i<s;++i)for(t=n;t<o;++t){const r=ct[i*H.x+t];if(r&&(!e||e.collideWithTile(r,c(t,i))))return!0}return!1}class ge{constructor(t,e=0,n=!1,i=new g){this.tile=t,this.direction=e,this.mirror=n,this.color=i}clear(){this.tile=this.direction=0,this.mirror=!1,this.color=new g}}class di extends Wt{constructor(t,e=H,n=Dt(),i=c(1),o=0){for(super(t,e,n,0,void 0,o),this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.scale=i,this.isOverlay=!1,this.data=[],t=this.size.area();t--;)this.data.push(new ge)}setData(t,e,n=!1){t.arrayCheck(this.size)&&(this.data[(t.y|0)*this.size.x+t.x|0]=e,n&&this.drawTileData(t))}getData(t){return t.arrayCheck(this.size)&&this.data[(t.y|0)*this.size.x+t.x|0]}update(){}render(){D!=this.context;let t=Ht(this.pos.add(c(0,this.size.y*this.scale.y)));t=t.floor(),(this.isOverlay?$:D).drawImage(this.canvas,t.x,t.y,R*this.size.x*this.scale.x,R*this.size.y*this.scale.y)}redraw(){this.redrawStart(!0);for(let t=this.size.x;t--;)for(let e=this.size.y;e--;)this.drawTileData(c(t,e),!1);this.redrawEnd()}redrawStart(t=!1){this.savedRenderSettings=[y,D,z,U,R],y=this.canvas,D=this.context,z=this.size.multiply(this.tileInfo.size),U=this.size.scale(.5),R=this.tileInfo.size.x,t&&(y.width=z.x,y.height=z.y),this.context.imageSmoothingEnabled=!1,Ee()}redrawEnd(){D==this.context,Ae(D,!0),[y,D,z,U,R]=this.savedRenderSettings}drawTileData(t,e=!0){var n=this.tileInfo.size;e&&(e=t.multiply(n),this.context.clearRect(e.x,this.canvas.height-e.y,n.x,-n.y)),e=this.getData(t),e.tile!=null&&(D==this.context,t=t.add(c(.5)),n=Dt(e.tile,n,this.tileInfo.textureIndex,this.tileInfo.padding),st(t,c(1),n,e.color,e.direction*x/2,e.mirror))}drawCanvas2D(t,e,n,i,o){const r=this.context;r.save(),t=t.subtract(this.pos).multiply(this.tileInfo.size),e=e.multiply(this.tileInfo.size),r.translate(t.x,this.canvas.height-t.y),r.rotate(n),r.scale(i?-e.x:e.x,e.y),o(r),r.restore()}drawTile(t,e=c(1),n,i=new g,o,r){this.drawCanvas2D(t,e,o,r,h=>{const a=n&&n.getTextureInfo();a?(h.globalAlpha=i.a,h.drawImage(a.image,n.pos.x,n.pos.y,n.size.x,n.size.y,-.5,-.5,1,1),h.globalAlpha=1):(h.fillStyle=i,h.fillRect(-.5,-.5,1,1))})}drawRect(t,e,n,i){this.drawTile(t,e,void 0,n,i)}}class mi extends Wt{constructor(t,e,n=0,i=0,o=100,r=x,h,a=new g,d=new g,m=new g(1,1,1,0),u=new g(1,1,1,0),f=.5,v=.1,L=1,Y=.1,C=.05,nt=1,X=1,mt=0,Z=x,P=.1,S=.2,Pt=!1,tt=!1,j=!0,Nt=tt?1e9:0,E=!1){super(t,c(),h,e,void 0,Nt),this.emitSize=n,this.emitTime=i,this.emitRate=o,this.emitConeAngle=r,this.colorStartA=a,this.colorStartB=d,this.colorEndA=m,this.colorEndB=u,this.randomColorLinear=j,this.particleTime=f,this.sizeStart=v,this.sizeEnd=L,this.speed=Y,this.angleSpeed=C,this.damping=nt,this.angleDamping=X,this.gravityScale=mt,this.particleConeAngle=Z,this.fadeRate=P,this.randomness=S,this.collideTiles=Pt,this.additive=tt,this.localSpace=E,this.trailScale=0,this.particleCreateCallback=this.particleDestroyCallback=void 0,this.emitTimeBuffer=0}update(){if(this.parent&&super.update(),!this.emitTime||this.getAliveTime()<=this.emitTime){if(this.emitRate*ee){const t=1/this.emitRate/ee;for(this.emitTimeBuffer+=Ii;0<this.emitTimeBuffer;this.emitTimeBuffer-=t)this.emitParticle()}}else this.destroy()}emitParticle(){var t=typeof this.emitSize=="number"?Oe(this.emitSize/2):c(w(-.5,.5),w(-.5,.5)).multiply(this.emitSize).rotate(this.angle);let e=w(this.particleConeAngle,-this.particleConeAngle);this.localSpace||(t=this.pos.add(t),e+=this.angle);const n=this.randomness;var i=f=>f+f*w(n,-n);const o=i(this.particleTime),r=i(this.sizeStart),h=i(this.sizeEnd),a=i(this.speed);i=i(this.angleSpeed)*Le();var d=w(this.emitConeAngle,-this.emitConeAngle);const m=It(this.colorStartA,this.colorStartB,this.randomColorLinear),u=It(this.colorEndA,this.colorEndB,this.randomColorLinear);return d=this.localSpace?d:this.angle+d,t=new fi(t,this.tileInfo,e,m,u,o,r,h,this.fadeRate,this.additive,this.trailScale,this.localSpace&&this,this.particleDestroyCallback),t.velocity=c().setAngle(d,a),t.angleVelocity=i,t.fadeRate=this.fadeRate,t.damping=this.damping,t.angleDamping=this.angleDamping,t.elasticity=this.elasticity,t.friction=this.friction,t.gravityScale=this.gravityScale,t.collideTiles=this.collideTiles,t.renderOrder=this.renderOrder,t.mirror=!!At(2),this.particleCreateCallback&&this.particleCreateCallback(t),t}render(){}}class fi extends Wt{constructor(t,e,n,i,o,r,h,a,d,m,u,f,v){super(t,c(),e,n),this.colorStart=i,this.colorEndDelta=o.subtract(i),this.lifeTime=r,this.sizeStart=h,this.sizeEndDelta=a-h,this.fadeRate=d,this.additive=m,this.trailScale=u,this.localSpaceEmitter=f,this.destroyCallback=v,this.clampSpeedLinear=!1}render(){const t=0<this.lifeTime?W((dt-this.spawnTime)/this.lifeTime,1):1,e=c(this.sizeStart+t*this.sizeEndDelta);var n=this.fadeRate/2;n=new g(this.colorStart.r+t*this.colorEndDelta.r,this.colorStart.g+t*this.colorEndDelta.g,this.colorStart.b+t*this.colorEndDelta.b,(this.colorStart.a+t*this.colorEndDelta.a)*(t<n?t/n:t>1-n?(1-t)/n:1)),this.additive&&re(!0);let i=this.pos,o=this.angle;if(this.localSpaceEmitter&&(i=this.localSpaceEmitter.pos.add(i.rotate(-this.localSpaceEmitter.angle)),o+=this.localSpaceEmitter.angle),this.trailScale){var r=this.velocity;this.localSpaceEmitter&&(r=r.rotate(-this.localSpaceEmitter.angle));var h=r.length();h&&(r=r.scale(1/h),h*=this.trailScale,e.y=Et(e.x,h),o=r.angle(),st(i.add(r.multiply(c(0,-h/2))),e,this.tileInfo,n,o,this.mirror))}else st(i,e,this.tileInfo,n,o,this.mirror);this.additive&&re(),t==1&&(this.color=n,this.size=e,this.destroyCallback&&this.destroyCallback(this),this.destroyed=1)}}const kt={};let wt=[],pe,xt;function yi(s){pe=s,gi(t=>t.unlocked=!!localStorage[t.storageKey()]),Ri(void 0,function(){if(wt.length){var t=wt[0],e=Gt-xt;if(xt)if(e>ie)xt=0,wt.shift();else{const n=ie-gt;t.render(e<gt?1-e/gt:e>n?(e-n)/gt:0)}else xt=Gt}})}function gi(s){Object.values(kt).forEach(t=>s(t))}class pi{constructor(t,e,n="",i="üèÜ",o){0<=t&&kt[t],this.id=t,this.name=e,this.description=n,this.icon=i,this.unlocked=!1,o&&((this.image=new Image).src=o),kt[t]=this}unlock(){this.unlocked||(localStorage[this.storageKey()]=this.unlocked=!0,wt.push(this))}render(t=0){const e=$;var n=W(se.x,y.width);const i=se.y;var o=M.width-n;t*=-i,e.save(),e.beginPath(),e.fillStyle=new g(.9,.9,.9).toString(),e.strokeStyle=new g(0,0,0).toString(),e.lineWidth=3,e.rect(o,t,n,i),e.fill(),e.stroke(),e.clip();const r=c(.1,.05).scale(i),h=i-2*r.x;this.renderIcon(c(o+r.x+h/2,t+i/2),h);const a=.5*i,d=.3*i;o=c(o+h+2*r.x,t+2*r.y+a/2),n=n-h-3*r.x,vt(this.name,o,a,new g(0,0,0),0,void 0,"left",void 0,n),o.y=t+i-2*r.y-d/2,vt(this.description,o,d,new g(0,0,0),0,void 0,"left",void 0,n),e.restore()}renderIcon(t,e){this.image?$.drawImage(this.image,t.x-e/2,t.y-e/2,e,e):vt(this.icon,t,.7*e,new g(0,0,0))}storageKey(){return pe+"_"+this.id}}let k,l,xi=!0,Tt,Ft,xe,Ut,N,jt,J,zt,Rt;const ve=1e4,Se=11,we=4*Se,Te=ve*we;function vi(){{k=document.createElement("canvas"),l=k.getContext("webgl2",{antialias:xi});var s=y.parentElement;s.appendChild(k),Tt=Ti(`#version 300 es
precision highp float;uniform mat4 m;in vec2 g;in vec4 p,u,c,a;in float r;out vec2 v;out vec4 d,e;void main(){vec2 s=(g-.5)*p.zw;gl_Position=m*vec4(p.xy+s*cos(r)-vec2(-s.y,s)*sin(r),1,1);v=mix(u.xw,u.zy,g);d=c;e=a;}`,`#version 300 es
precision highp float;uniform sampler2D s;in vec2 v;in vec4 d,e;out vec4 c;void main(){c=texture(s,v)*d+e;}`),s=new ArrayBuffer(Te),N=new Float32Array(s),jt=new Uint32Array(s),xe=l.createBuffer(),Ut=l.createBuffer(),s=new Float32Array([J=0,0,1,0,0,1,1,1]),l.bindBuffer(l.ARRAY_BUFFER,Ut),l.bufferData(l.ARRAY_BUFFER,s,l.STATIC_DRAW)}}function Ee(){{Si(),l.useProgram(Tt),l.activeTexture(l.TEXTURE0),Q[0]&&l.bindTexture(l.TEXTURE_2D,Ft=Q[0].glTexture);var s=zt=Rt=0,t=(n,i,o,r)=>{n=l.getAttribLocation(Tt,n);const h=o&&we,a=o&&1,d=o==1;l.enableVertexAttribArray(n),l.vertexAttribPointer(n,r,i,d,h,s),l.vertexAttribDivisor(n,a),s+=r*o};l.bindBuffer(l.ARRAY_BUFFER,Ut),t("g",l.FLOAT,0,2),l.bindBuffer(l.ARRAY_BUFFER,xe),l.bufferData(l.ARRAY_BUFFER,Te,l.DYNAMIC_DRAW),t("p",l.FLOAT,4,4),t("u",l.FLOAT,4,4),t("c",l.UNSIGNED_BYTE,1,4),t("a",l.UNSIGNED_BYTE,1,4),t("r",l.FLOAT,4,1),t=c(2*R).divide(z);var e=c(-1).subtract(U.multiply(t));l.uniformMatrix4fv(l.getUniformLocation(Tt,"m"),!1,[t.x,0,0,0,0,t.y,0,0,1,1,1,1,e.x,e.y,0,0])}}function Si(){l.viewport(0,0,k.width=y.width,k.height=y.height),l.clear(l.COLOR_BUFFER_BIT)}function wi(s){s==Ft||(Kt(),l.bindTexture(l.TEXTURE_2D,Ft=s))}function ae(s,t){return t=l.createShader(t),l.shaderSource(t,s),l.compileShader(t),t}function Ti(s,t){const e=l.createProgram();return l.attachShader(e,ae(s,l.VERTEX_SHADER)),l.attachShader(e,ae(t,l.FRAGMENT_SHADER)),l.linkProgram(e),e}function Ei(s){const t=l.createTexture();return l.bindTexture(l.TEXTURE_2D,t),s&&s.width?l.texImage2D(l.TEXTURE_2D,0,l.RGBA,l.RGBA,l.UNSIGNED_BYTE,s):(s=new Uint8Array([255,255,255,255]),l.texImage2D(l.TEXTURE_2D,0,l.RGBA,1,1,0,l.RGBA,l.UNSIGNED_BYTE,s)),s=l.NEAREST,l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,s),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,s),t}function Kt(){if(J){var s=Rt?l.ONE:l.ONE_MINUS_SRC_ALPHA;l.blendFuncSeparate(l.SRC_ALPHA,s,l.ONE,s),l.enable(l.BLEND),l.bufferSubData(l.ARRAY_BUFFER,0,N),l.drawArraysInstanced(l.TRIANGLE_STRIP,0,4,J),J=0,Rt=zt}}function Ae(s,t=!1){(J||t)&&(Kt(),!t||s.drawImage(k,0,0))}function le(s,t,e,n,i,o,r,h,a,d,m=0){(J>=ve||Rt!=zt)&&Kt();let u=J++*Se;N[u++]=s,N[u++]=t,N[u++]=e,N[u++]=n,N[u++]=o,N[u++]=r,N[u++]=h,N[u++]=a,jt[u++]=d,jt[u++]=m,N[u++]=i}const Ie="LittleJS",Ai="1.11.13",_t=60,Ii=1/_t;let V=[],De=[],Di=0,dt=0,Gt=0,he=0,B=0;const Ci=[],Ce=[];function Ri(s,t){t&&Ce.push(t)}function zi(s,t,e,n,i,o=[],r=document.body){function h(m=0){var u=m-he;he=m,m=Ne,Gt+=u/1e3,B+=u,m||(B=W(B,50)),a();{for(u=0,0>B&&-9<B&&(u=B,B=0);0<=B;B-=1e3/_t)dt=Di++/_t,ei(),t(),Ci.forEach(v=>v()),Pi(),e(),ii();B+=u}{z=c(y.width,y.height),$.imageSmoothingEnabled=D.imageSmoothingEnabled=!1,Ee(),n(),V.sort((v,L)=>v.renderOrder-L.renderOrder);for(var f of V)f.destroyed||f.render();i(),Ce.forEach(v=>v()),Ae(D)}requestAnimationFrame(h)}function a(){{if(bt.x){y.width=bt.x,y.height=bt.y;const m=innerWidth/innerHeight,u=y.width/y.height;(k||y).style.width=y.style.width=M.style.width=m<u?"100%":"",(k||y).style.height=y.style.height=M.style.height=m<u?"":"100%"}else y.width=W(innerWidth,te.x),y.height=W(innerHeight,te.y);M.width=y.width,M.height=y.height,z=c(y.width,y.height)}}function d(){new Promise(m=>m(s())).then(h)}s||=()=>{},t||=()=>{},e||=()=>{},n||=()=>{},i||=()=>{},r.style.cssText="margin:0;overflow:hidden;width:100vw;height:100vh;display:flex;align-items:center;justify-content:center;background:#000;image-rendering:pixelated;user-select:none;-webkit-user-select:none;touch-action:none;-webkit-touch-callout:none",r.appendChild(y=document.createElement("canvas")),D=y.getContext("2d"),si(),oi(),vi(),r.appendChild(M=document.createElement("canvas")),$=M.getContext("2d"),y.style.cssText=M.style.cssText="position:absolute",k&&(k.style.cssText="position:absolute"),a(),r=o.map((m,u)=>new Promise(f=>{const v=new Image;v.crossOrigin="anonymous",v.onerror=v.onload=()=>{Q[u]=new ne(v),f()},v.src=m})),o.length||r.push(new Promise(m=>{Q[0]=new ne(new Image),m()})),ue&&r.push(new Promise(m=>{function u(){Xt(),Ni(f+=.01),1<f?m():setTimeout(u,16)}let f=0;console.log(`${Ie} Engine v${Ai}`),u()})),Promise.all(r).then(d)}function Pi(){function s(t){if(!t.destroyed){t.update();for(const e of t.children)s(e)}}De=V.filter(t=>t.collideSolidObjects);for(const t of V)t.parent||(s(t),t.updateTransforms());V=V.filter(t=>!t.destroyed)}function Ni(s){const t=$;var e=M.width=innerWidth,n=M.height=innerHeight,i=_(s,1,.8),o=_(s,0,.5),r=t.createRadialGradient(e/2,n/2,0,e/2,n/2,.7*Math.hypot(e,n));r.addColorStop(0,G(0,0,ht(o,0,i/2),i).toString()),r.addColorStop(1,G(0,0,0,i).toString()),t.save(),t.fillStyle=r,t.fillRect(0,0,e,n),r=(a,d,m,u,f)=>{t.beginPath(),t.rect(a,d,m,f?u*h:u),(t.fillStyle=f)?t.fill():t.stroke()},o=(a,d,m,u=0,f=2*x,v,L)=>{const Y=(u+f)/2;u=h*(f-u)/2,t.beginPath(),L&&t.lineTo(a,d),t.arc(a,d,m,Y-u,Y+u),(t.fillStyle=v)?t.fill():t.stroke()},i=(a=0,d=0)=>G([.98,.3,.57,.14][a%4]-10,.8,[0,.3,.5,.8,.9][d]).toString(),s=be(1,1,s);const h=_(s,.1,.5);for(t.translate(e/2,n/2),e=W(6,W(e,n)/99),t.scale(e,e),t.translate(-40,-35),t.lineJoin=t.lineCap="round",t.lineWidth=.1+1.9*h,e=_(s,.1,1),t.setLineDash([99*e,99]),r(7,16,18,-8,i(2,2)),r(7,8,18,4,i(2,3)),r(25,8,8,8,i(2,1)),r(25,8,-18,8),r(25,8,8,8),r(25,16,7,23,i()),r(11,39,14,-23,i(1,1)),r(11,16,14,18,i(1,2)),r(11,16,14,8,i(1,3)),r(25,16,-14,24),r(15,29,6,-9,i(2,2)),o(15,21,5,0,x/2,i(2,4),1),r(21,21,-6,9),r(37,14,9,6,i(3,2)),r(37,14,4.5,6,i(3,3)),r(37,14,9,6),r(50,20,10,-8,i(0,1)),r(50,20,6.5,-8,i(0,2)),r(50,20,3.5,-8,i(0,3)),r(50,20,10,-8),o(55,2,11.4,.5,x-.5,i(3,3)),o(55,2,11.4,.5,x/2,i(3,2),1),o(55,2,11.4,.5,x-.5),r(45,7,20,-7,i(0,2)),r(45,-1,20,4,i(0,3)),r(45,-1,20,8),e=5;e--;)o(60-6*e,30,9.9,0,2*x,i(e+2,3)),o(60-6*e,30,10,-.5,x+.5,i(e+2,2)),o(60-6*e,30,10.1,.5,x-.5,i(e+2,1));for(o(36,30,10,x/2,3*x/2),o(48,30,10,x/2,3*x/2),o(60,30,10),t.beginPath(),t.lineTo(36,20),t.lineTo(60,20),t.stroke(),o(60,30,4,x,3*x,i(3,2)),o(60,30,4,x,2*x,i(3,3)),o(60,30,4,x,3*x),e=6;e--;)t.beginPath(),t.lineTo(53,54),t.lineTo(53,40),t.lineTo(53+(1+2.9*e)*h,40),t.lineTo(53+(4+3.5*e)*h,54),t.fillStyle=i(0,e%2+2),t.fill(),e%2&&t.stroke();for(r(6,40,5,5),r(6,40,5,5,i()),r(15,54,38,-14,i()),r=3;r--;)for(e=2;e--;)o(15*r+15,47,e?7:1,x,3*x,i(r,3)),t.stroke(),o(15*r+15,47,e?7:1,0,x,i(r,2)),t.stroke();for(t.beginPath(),t.lineTo(6,40),t.lineTo(68,40),t.stroke(),t.beginPath(),t.lineTo(77,54),t.lineTo(4,54),t.stroke(),o=Ie,t.font="900 16px arial",t.textAlign="center",t.textBaseline="top",t.lineWidth=.1+3.9*h,r=0,e=0;e<o.length;++e)r+=t.measureText(o[e]).width;for(e=2;e--;)for(let a=0,d=41-r/2;a<o.length;++a)t.fillStyle=i(a,2),n=t.measureText(o[a]).width,t[e?"strokeText":"fillText"](o[a],d+n/2,55.5,17*h),d+=n;t.restore()}let Re;const bi=s=>Re=s,Li=()=>Re;function Oi(){const s=c(32,16);ci(s);const t=c(),e=new di(t,s),n=D,i=Q[0].image;n.drawImage(i,0,0);const o=n.getImageData(0,0,i.width,i.height).data;for(t.x=s.x;t.x--;)for(t.y=s.y;t.y--;){const h=t.x+i.width*(15+s.y-t.y);if(!o[4*h])continue;const a=1,d=At(4),m=!At(2),u=It(),f=new ge(a,d,m,u);e.setData(t,f),ui(t,1)}e.redraw(),Xe(s.scale(.5)),qe(48),Ve(-.01);const r=new mi(c(16,9),0,1,0,500,Math.PI,Dt(0,16),G(1,1,1),G(0,0,0),G(0,0,0,0),G(0,0,0,0),2,.2,.2,.1,.05,.99,1,1,Math.PI,.05,.5,!0,!0);r.elasticity=.3,r.trailScale=2,bi(r)}function Bi(){Je(c(16,8),c(20,14),G(0,0,.6),0,!1),st(c(21,5),c(4.5),Dt(3,128))}function Mi(){vt("LittleJS Template",c(z.x/2,80),80)}const ki=new ai([1,.5]),Fi=new pi(0,"Example Medal","Welcome to LittleJS!");yi("Hello World");function Ui(){const s=Li();ti(0)&&(ki.play(Bt),s.colorStartA=G(),s.colorStartB=It(),s.colorEndA=s.colorStartA.scale(1,0),s.colorEndB=s.colorStartB.scale(1,0),Fi.unlock()),ut.x&&(s.pos=Bt)}function ji(){}Ke(!0);zi(Oi,Ui,ji,Bi,Mi);
